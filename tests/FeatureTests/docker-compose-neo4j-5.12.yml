services:

  ember-nexus-api:
    container_name: ember-nexus-api
    image: api:dev-amd
    expose:
      - "80"
    depends_on:
      - ember-nexus-neo4j
      - ember-nexus-mongodb
      - ember-nexus-elasticsearch
      - ember-nexus-redis
      - ember-nexus-rabbitmq
    volumes:
      - ../../:/var/www/html
    profiles:
      - api

  ember-nexus-neo4j:
    container_name: ember-nexus-neo4j
    image: neo4j:5.12
    expose:
      - "7474"
      - "7687"
    environment:
      - NEO4J_AUTH=neo4j/password
    profiles:
      - database

  ember-nexus-mongodb:
    container_name: ember-nexus-mongodb
    image: mongo:7
    expose:
      - "27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=mongodb
      - MONGO_INITDB_ROOT_PASSWORD=password
    profiles:
      - database

  ember-nexus-elasticsearch:
    container_name: ember-nexus-elasticsearch
    image: elasticsearch:8.8.1
    expose:
      - "9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - xpack.security.enrollment.enabled=true
    profiles:
      - database

  ember-nexus-redis:
    container_name: ember-nexus-redis
    image: redis:7-alpine
    expose:
      - "6379"
    command: redis-server --save 20 1 --loglevel warning --requirepass redis-password
    profiles:
      - database

  ember-nexus-rabbitmq:
    container_name: ember-nexus-rabbitmq
    image: rabbitmq:3-management
    expose:
      - "5672"
      - "15672"
    environment:
      - RABBITMQ_DEFAULT_USER=user
      - RABBITMQ_DEFAULT_PASS=password
    profiles:
      - database
